<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Multiplayer Pixel Art</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: sans-serif; }
        canvas { background: white; image-rendering: pixelated; cursor: none; }
        .controls { position: fixed; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 8px; z-index: 10; }
        .cursor {
            position: absolute;
            pointer-events: none;
            font-size: 12px;
            white-space: nowrap;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        .cursor-dot {
            width: 6px;
            height: 6px;
            background: red;
            border-radius: 50%;
        }
    </style>
</head>
<body>

<div class="controls">
    <input type="color" id="colorPicker" value="#000000">
    <span id="userNameDisplay"></span>
</div>

<canvas id="canvas" width="1024" height="2048"></canvas>
<div id="cursors"></div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyCwk4Im8EtC_Eyu7dllwqTW54dwOXPhhf4",
      authDomain: "freedraw-ef17b.firebaseapp.com",
      projectId: "freedraw-ef17b",
      storageBucket: "freedraw-ef17b.firebasestorage.app",
      messagingSenderId: "155298386414",
      appId: "1:155298386414:web:f2a57cb5556a8e05c13eff",
      measurementId: "G-24TC2QCP4R"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const colorPicker = document.getElementById('colorPicker');
    const cursorsLayer = document.getElementById('cursors');
    
    const userName = prompt("Podaj swÃ³j nick:") || "Anon" + Math.floor(Math.random() * 1000);
    const userId = Math.random().toString(36).substring(7);
    document.getElementById('userNameDisplay').innerText = "Grasz jako: " + userName;

    const userRef = db.ref('users/' + userId);
    userRef.onDisconnect().remove();

    db.ref('pixels').on('child_added', (snap) => {
        const [x, y] = snap.key.split('_');
        ctx.fillStyle = snap.val();
        ctx.fillRect(x, y, 1, 1);
    });

    db.ref('pixels').on('child_changed', (snap) => {
        const [x, y] = snap.key.split('_');
        ctx.fillStyle = snap.val();
        ctx.fillRect(x, y, 1, 1);
    });

    canvas.addEventListener('mousedown', (e) => {
        const x = Math.floor(e.clientX);
        const y = Math.floor(e.clientY);
        db.ref('pixels/' + x + '_' + y).set(colorPicker.value);
    });

    window.addEventListener('mousemove', (e) => {
        userRef.set({
            x: e.clientX,
            y: e.clientY,
            name: userName
        });
    });

    db.ref('users').on('value', (snap) => {
        cursorsLayer.innerHTML = '';
        const users = snap.val();
        for (let id in users) {
            if (id === userId) continue;
            const u = users[id];
            const div = document.createElement('div');
            div.className = 'cursor';
            div.style.left = u.x + 'px';
            div.style.top = u.y + 'px';
            div.innerHTML = `<div class="cursor-dot"></div> ${u.name}`;
            cursorsLayer.appendChild(div);
        }
    });
</script>

</body>
</html>
